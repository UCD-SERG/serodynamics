% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/run_mod_kron.R
\name{run_mod_kron}
\alias{run_mod_kron}
\title{Run the Kronecker (correlated biomarkers) model}
\usage{
run_mod_kron(
  data,
  file_mod = "model_ch2_kron.jags",
  nchain = 4,
  nadapt = 0,
  nburn = 0,
  nmc = 100,
  niter = 100,
  strat = NA,
  with_post = FALSE,
  monitor = c("y0", "y1", "t1", "alpha", "shape", "TauB", "TauP"),
  ...
)
}
\arguments{
\item{data}{A long table (like from \code{as_case_data()}), consumed by
\code{prep_data()}.}

\item{file_mod}{Path to the JAGS model file. Use \code{write_model_ch2_kron()}
to generate it.}

\item{nchain, nadapt, nburn, nmc, niter}{MCMC settings (same semantics as
\code{run_mod()}).}

\item{strat}{Optional column name to stratify by (same behavior as
\code{run_mod()}).}

\item{with_post}{Logical; when \code{TRUE}, attaches raw \code{jags.post} in the
output attributes.}

\item{monitor}{Character vector of nodes to monitor. Defaults to core
parameters
plus \code{TauB} and \code{TauP}.}

\item{...}{Additional arguments passed to \code{prep_priors()}
(e.g. \code{mu_hyp_param}).}
}
\value{
A tibble with the same general structure as \code{run_mod()} output, with
attributes carrying priors used, MCMC metadata, fitted values, and
optionally \code{jags.post}.
}
\description{
\code{run_mod_kron()} is a convenience wrapper to fit the Chapter 2
Kronecker model while keeping the same output shape as
\code{\link[=run_mod]{run_mod()}}. It prepares the data, combines the base
priors with Kronecker priors, and calls \strong{runjags}.

Required helpers available in the package environment:
\itemize{
\item \code{prep_data()}, \code{prep_priors()}, and \code{calc_fit_mod()}.
}
}
\examples{
# Minimal end-to-end example (small settings for speed)

# 1) Write the Kronecker model once
model_path <- write_model_ch2_kron(file.path(tempdir(), "model_ch2_kron.jags"))

# 2) Simulate a tiny dataset
set.seed(926)
n_blocks  <- 2
time_grid <- c(0, 7, 14, 30)

sd_p <- c(0.35, 0.45, 0.25, 0.30, 0.25)
R_p  <- matrix(0.25, 5, 5)
diag(R_p) <- 1
sigma_p <- diag(sd_p) \%*\% R_p \%*\% diag(sd_p)

R_b <- matrix(c(1, 0.5,
                0.5, 1), n_blocks, n_blocks, byrow = TRUE)
sd_b <- rep(0.6, n_blocks)
sigma_b <- diag(sd_b) \%*\% R_b \%*\% diag(sd_b)

sim <- simulate_multi_b_long(
  n_id      = 5,
  n_blocks  = n_blocks,
  time_grid = time_grid,
  sigma_p   = sigma_p,
  sigma_b   = sigma_b
)

# 3) Convert to case_data expected by prep_data/run_mod
long_tbl <- serodynamics::as_case_data(
  sim$data,
  id_var        = "Subject",
  biomarker_var = "antigen_iso",
  value_var     = "value",
  time_in_days  = "time_days"
)

# 4) Fit the Kronecker model (very small MCMC for demonstration)
out <- run_mod_kron(
  data     = long_tbl,
  file_mod = model_path,
  nchain   = 2, nadapt = 200, nburn = 200,
  nmc      = 200, niter = 2000,
  strat    = NA
)
\dontrun{
out <- run_mod_kron(
  data     = long_tbl,
  file_mod = model_path,
  nchain   = 2, nadapt = 200, nburn = 200,
  nmc      = 200, niter = 2000,
  strat    = NA
)
}
}
\author{
Kwan Ho Lee
}
