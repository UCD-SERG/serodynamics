% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/simulate_multi_b_long2.R
\name{simulate_multi_b_long2}
\alias{simulate_multi_b_long2}
\title{Simulate longitudinal data (user-supplied trajectory)}
\usage{
simulate_multi_b_long2(
  n_id,
  n_blocks,
  time_grid,
  sigma_p,
  sigma_b,
  mu_latent_base = c(log(1), log(5), log(30), log(0.02), log(1.5)),
  meas_sd = rep(0.22, n_blocks),
  ab_vec = NULL
)
}
\arguments{
\item{n_id}{Integer: number of subjects.}

\item{n_blocks}{Integer (B): number of biomarkers.}

\item{time_grid}{Numeric vector of visit times (days).}

\item{sigma_p}{5x5 within-biomarker covariance of latent params
(\code{log_y0}, \code{log_y1m0}, \code{log_t1}, \code{log_alpha}, \code{log(rho_m1)}).}

\item{sigma_b}{\code{B x B} across-biomarker covariance.}

\item{mu_latent_base}{Length-5 mean vector on the latent scale for a single
biomarker (recycled across \code{n_blocks}).}

\item{meas_sd}{Length-\code{n_blocks} vector (or scalar) of log-scale
measurement SDs per biomarker.}

\item{ab_vec}{A vectorized trajectory with signature
\code{f(t, y0, y1, t1, alpha, shape)}. If \code{NULL}, a default
vectorized wrapper of \code{serodynamics::ab()} is used.}
}
\value{
A list with:
\itemize{
\item \code{data}: tibble with columns \code{Subject}, \code{visit_num}, \code{antigen_iso},
\code{time_days}, \code{value}.
\item \code{truth}: list with \code{m_true}, \code{sigma_p}, \code{sigma_b}, \code{sigma_total},
\code{meas_sd}, and \code{theta_latent}.
}
}
\description{
\code{simulate_multi_b_long2()} simulates subject-level latent parameters with a
Kronecker covariance \eqn{\Sigma_B \otimes \Sigma_P} (5 parameters per
biomarker), then generates noisy observations on a time grid. The expected
trajectory is computed by a \strong{vectorized} function we supply.
}
\examples{
set.seed(925)

# Define dimensions and covariances
n_blocks  <- 2
time_grid <- c(0, 7, 14, 30)

sd_p <- c(0.35, 0.45, 0.25, 0.30, 0.25)
R_p  <- matrix(0.25, 5, 5); diag(R_p) <- 1
sigma_p <- diag(sd_p) \%*\% R_p \%*\% diag(sd_p)

R_b <- matrix(c(1, 0.5,
                0.5, 1), n_blocks, n_blocks, byrow = TRUE)
sd_b   <- rep(0.6, n_blocks)
sigma_b <- diag(sd_b) \%*\% R_b \%*\% diag(sd_b)

# Use default serodynamics trajectory (make_ab_vec is used internally)
sim2 <- simulate_multi_b_long2(
  n_id      = 5,
  n_blocks  = n_blocks,
  time_grid = time_grid,
  sigma_p   = sigma_p,
  sigma_b   = sigma_b
)

head(sim2$data)

# Optional: use a custom trajectory instead of the default
custom_fun <- function(t, y0, y1, t1, alpha, shape) {
  # simple saturating rise curve (toy)
  y0 + (y1 - y0) * (1 - exp(-alpha * t))
}

sim2_custom <- simulate_multi_b_long2(
  n_id      = 3,
  n_blocks  = n_blocks,
  time_grid = time_grid,
  sigma_p   = sigma_p,
  sigma_b   = sigma_b,
  ab_vec    = make_ab_vec(custom_fun)
)

head(sim2_custom$data)
}
\seealso{
simulate_multi_b_long
}
\author{
Kwan Ho Lee
}
