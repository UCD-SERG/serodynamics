<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Hierarchical Bayesian Modeling of Antibody Kinetics: Extensions and Refinements ‚Ä¢ serodynamics</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="Antibody_Kinetics_files/libs/quarto-html/popper.min.js"></script><script src="Antibody_Kinetics_files/libs/quarto-html/tippy.umd.min.js"></script><link href="Antibody_Kinetics_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Antibody_Kinetics_files/libs/quarto-html/light-border.css" rel="stylesheet">
<!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Hierarchical Bayesian Modeling of Antibody Kinetics: Extensions and Refinements">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">serodynamics</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.0.0.9032</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Antibody_Kinetics.html">Hierarchical Bayesian Modeling of Antibody Kinetics: Extensions and Refinements</a></li>
    <li><a class="dropdown-item" href="../articles/Beamer_Antibody_Kinetics.html">Extending the Hierarchical Model for Antibody Kinetics</a></li>
    <li><a class="dropdown-item" href="../articles/dobson.html">dobson</a></li>
    <li><a class="dropdown-item" href="../articles/Hierarchical_Bayesian_Model.html">Hierarchical Bayesian Model</a></li>
    <li><a class="dropdown-item" href="../articles/test-snippets.html">test-snippets</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/UCD-SERG/serodynamics/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Hierarchical Bayesian Modeling of Antibody Kinetics: Extensions and Refinements</h1>

      <p class="author">Kwan Ho Lee</p>
      <p class="date">2025-05-22</p>

      <small class="dont-index">Source: <a href="https://github.com/UCD-SERG/serodynamics/blob/beamer/vignettes/articles/Antibody_Kinetics.qmd" class="external-link"><code>vignettes/articles/Antibody_Kinetics.qmd</code></a></small>
      <div class="d-none name"><code></code></div>
    </div>






    <section class="level2"><h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<ul>
<li>Incorporates feedback from Dr.¬†Morrison, Dr.¬†Aiemjoy, and lab discussion</li>
<li>Focus exclusively on <span class="citation" data-cites="teunis2016">(<a href="#ref-teunis2016" role="doc-biblioref">Teunis and Eijkeren 2016</a>)</span> two-phase within-host model</li>
<li>Clarifies full hierarchical Bayesian modeling structure</li>
<li>Explicitly distinguishes between priors, hyperpriors, transformations</li>
<li>Reorders: <strong>Start from observation model ‚Üí build upward</strong>
</li>
</ul>
<hr></section><section class="level2"><h2 id="big-picture-what-are-we-modeling">Big Picture: What Are We Modeling?<a class="anchor" aria-label="anchor" href="#big-picture-what-are-we-modeling"></a>
</h2>
<p>We are modeling <strong>how antibody levels change over time</strong> in response to infection, using multiple individuals and multiple biomarkers (antigen-isotype combinations, (j = 1, 2, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>‚Ä¶</mi><annotation encoding="application/x-tex">\dots</annotation></semantics></math>, 10)).</p>
<p>Goals:</p>
<ul>
<li>Understand the <strong>average pattern</strong> for each biomarker</li>
<li>Allow for <strong>individual-level variation</strong>
</li>
<li>
<strong>Share information</strong> across individuals to improve inference</li>
</ul>
<p>This motivates using a <strong>hierarchical Bayesian model</strong>.</p>
<hr></section><section class="level2"><h2 id="step-1-observation-model-data-level">Step 1: Observation Model (Data Level)<a class="anchor" aria-label="anchor" href="#step-1-observation-model-data-level"></a>
</h2>
<p>Observed (log-transformed) antibody levels:</p>
<p><span id="eq-1"><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mtext mathvariant="normal">obs</mtext><mo>,</mo><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚àº</mo><mi>ùí©</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Œº</mi><mrow><mo>log</mo><mi>y</mi><mo>,</mo><mi>i</mi><mi>j</mi></mrow></msub><mo>,</mo><msubsup><mi>œÑ</mi><mi>j</mi><mrow><mi>‚àí</mi><mn>1</mn></mrow></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="2.0em"></mspace><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
\log(y_{\text{obs},ij}) \sim \mathcal{N}(\mu_{\log y,ij}, \tau_j^{-1})
 \qquad(1)</annotation></semantics></math></span></p>
<p>Where:</p>
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mrow><mtext mathvariant="normal">obs</mtext><mo>,</mo><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">y_{\text{obs},ij}</annotation></semantics></math>: Observed antibody level for subject <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math> and biomarker <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>
</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œº</mi><mrow><mo>log</mo><mi>y</mi><mo>,</mo><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">\mu_{\log y,ij}</annotation></semantics></math> is the <strong>expected log antibody level</strong>, computed from the two-phase model using subject-level parameters <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œ∏</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">\theta_{ij}</annotation></semantics></math>.</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œ∏</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">\theta_{ij}</annotation></semantics></math>: Subject-level latent parameters (e.g., <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mn>0</mn></msub><mo>,</mo><mi>Œ±</mi><mo>,</mo><mi>œÅ</mi></mrow><annotation encoding="application/x-tex">y_0, \alpha, \rho</annotation></semantics></math>) used to define the predicted antibody curve</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>œÑ</mi><mi>j</mi></msub><annotation encoding="application/x-tex">\tau_j</annotation></semantics></math>: Measurement precision (inverse of variance) specific to biomarker <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>
</li>
</ul>
<p>The expression above corresponds to line 54 of <code>model.jags</code>:</p>
<div class="sourceCode" id="cb1" data-startfrom="54"><pre class="sourceCode numberSource r number-lines"><code class="sourceCode r" style="counter-reset: source-line 53;"><span id="cb1-54"><a href="#cb1-54"></a>     logy[subj,obs,cur_antigen_iso] <span class="sc">~</span> <span class="fu">dnorm</span>(mu.logy[subj,obs,cur_antigen_iso], prec.logy[cur_antigen_iso])</span></code></pre></div>
<p>Measurement precision prior:</p>
<p><span id="eq-2"><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>œÑ</mi><mi>j</mi></msub><mo>‚àº</mo><mtext mathvariant="normal">Gamma</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>a</mi><mi>j</mi></msub><mo>,</mo><msub><mi>b</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="2.0em"></mspace><mrow><mo stretchy="true" form="prefix">(</mo><mn>2</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
\tau_j \sim \text{Gamma}(a_j, b_j)
 \qquad(2)</annotation></semantics></math></span></p>
<p>Where:</p>
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>œÑ</mi><mi>j</mi></msub><annotation encoding="application/x-tex">\tau_j</annotation></semantics></math>: Precision (inverse of variance) of the measurement noise for biomarker <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>
</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>a</mi><mi>j</mi></msub><mo>,</mo><msub><mi>b</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(a_j, b_j)</annotation></semantics></math>: Shape and rate hyperparameters of the Gamma prior for precision, which control its expected value and variability</li>
</ul>
<p>The expression above corresponds to line 75 of <code>model.jags</code>:</p>
<div class="sourceCode" id="cb2" data-startfrom="75"><pre class="sourceCode numberSource r number-lines"><code class="sourceCode r" style="counter-reset: source-line 74;"><span id="cb2-75"><a href="#cb2-75"></a>  prec.logy[cur_antigen_iso] <span class="sc">~</span> <span class="fu">dgamma</span>(prec.logy.hyp[cur_antigen_iso,<span class="dv">1</span>], prec.logy.hyp[cur_antigen_iso,<span class="dv">2</span>])</span></code></pre></div>
<hr></section><section class="level2"><h2 id="parameter-summary">Parameter Summary<a class="anchor" aria-label="anchor" href="#parameter-summary"></a>
</h2>
<div id="tbl-param-summary" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-tbl"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-param-summary-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table¬†1: Parameter summary for antibody kinetics model.
</figcaption><div aria-describedby="tbl-param-summary-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table caption-top">
<thead><tr class="header">
<th>Symbol</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œº</mi><mi>y</mi></msub><annotation encoding="application/x-tex">\mu_y</annotation></semantics></math></td>
<td>Antibody production rate (growth phase)</td>
</tr>
<tr class="even">
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œº</mi><mi>b</mi></msub><annotation encoding="application/x-tex">\mu_b</annotation></semantics></math></td>
<td>Pathogen replication rate</td>
</tr>
<tr class="odd">
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œ≥</mi><annotation encoding="application/x-tex">\gamma</annotation></semantics></math></td>
<td>Clearance rate (by antibodies)</td>
</tr>
<tr class="even">
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œ±</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math></td>
<td>Antibody decay rate</td>
</tr>
<tr class="odd">
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>œÅ</mi><annotation encoding="application/x-tex">\rho</annotation></semantics></math></td>
<td>Shape of antibody decay (power-law)</td>
</tr>
<tr class="even">
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>t</mi><mn>1</mn></msub><annotation encoding="application/x-tex">t_1</annotation></semantics></math></td>
<td>Time of peak response</td>
</tr>
<tr class="odd">
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mn>1</mn></msub><annotation encoding="application/x-tex">y_1</annotation></semantics></math></td>
<td>Peak antibody concentration</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p><strong>Note:</strong> Only the first 6 are typically estimated. <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mn>1</mn></msub><annotation encoding="application/x-tex">y_1</annotation></semantics></math> is derived from the ODE solution at <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>t</mi><mn>1</mn></msub><annotation encoding="application/x-tex">t_1</annotation></semantics></math>.</p>
<hr></section><section class="level2"><h2 id="step-2-within-host-ode-system-teunis2016">Step 2: Within-Host ODE System <span class="citation" data-cites="teunis2016">(<a href="#ref-teunis2016" role="doc-biblioref">Teunis and Eijkeren 2016</a>)</span>
<a class="anchor" aria-label="anchor" href="#step-2-within-host-ode-system-teunis2016"></a>
</h2>
<p><span id="eq-3"><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mi>d</mi><mi>y</mi></mrow><mrow><mi>d</mi><mi>t</mi></mrow></mfrac><mo>=</mo><mrow><mo stretchy="true" form="prefix">{</mo><mtable><mtr><mtd columnalign="left" style="text-align: left"><msub><mi>Œº</mi><mi>y</mi></msub><mi>y</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mtd><mtd columnalign="left" style="text-align: left"><mi>t</mi><mo>‚â§</mo><msub><mi>t</mi><mn>1</mn></msub></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><mi>‚àí</mi><mi>Œ±</mi><mi>y</mi><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>œÅ</mi></msup><mo>,</mo></mtd><mtd columnalign="left" style="text-align: left"><mi>t</mi><mo>&gt;</mo><msub><mi>t</mi><mn>1</mn></msub></mtd></mtr></mtable></mrow><mspace width="1.0em"></mspace><mtext mathvariant="normal">and</mtext><mspace width="1.0em"></mspace><mfrac><mrow><mi>d</mi><mi>b</mi></mrow><mrow><mi>d</mi><mi>t</mi></mrow></mfrac><mo>=</mo><msub><mi>Œº</mi><mi>b</mi></msub><mi>b</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚àí</mo><mi>Œ≥</mi><mi>y</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="2.0em"></mspace><mrow><mo stretchy="true" form="prefix">(</mo><mn>3</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
\frac{dy}{dt} =
\begin{cases}
\mu_y y(t), &amp; t \leq t_1 \\
- \alpha y(t)^\rho, &amp; t &gt; t_1
\end{cases}
\quad \text{and} \quad
\frac{db}{dt} = \mu_b b(t) - \gamma y(t)
 \qquad(3)</annotation></semantics></math></span></p>
<ul>
<li>Initial conditions: <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>y</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">y(0) = y_0</annotation></semantics></math>, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>b</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">b(0) = b_0</annotation></semantics></math>
</li>
<li>Transition at <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>t</mi><mn>1</mn></msub><annotation encoding="application/x-tex">t_1</annotation></semantics></math>: when <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mn>1</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">b(t_1) = 0</annotation></semantics></math>
</li>
</ul>
<hr></section><section class="level2"><h2 id="step-3-closed-form-solutions">Step 3: Closed-Form Solutions<a class="anchor" aria-label="anchor" href="#step-3-closed-form-solutions"></a>
</h2>
<p><strong>Antibody concentration:</strong></p>
<ul>
<li>For <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>‚â§</mo><msub><mi>t</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">t \leq t_1</annotation></semantics></math>: <span id="eq-4"><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>y</mi><mn>0</mn></msub><msup><mi>e</mi><mrow><msub><mi>Œº</mi><mi>y</mi></msub><mi>t</mi></mrow></msup><mspace width="2.0em"></mspace><mrow><mo stretchy="true" form="prefix">(</mo><mn>4</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
y(t) = y_0 e^{\mu_y t}
 \qquad(4)</annotation></semantics></math></span>
</li>
<li>For <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mspace width="0.222em"></mspace><msub><mi>t</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">t \&gt; t_1</annotation></semantics></math>: <span id="eq-5"><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>y</mi><mn>1</mn></msub><msup><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>+</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>œÅ</mi><mo>‚àí</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mi>Œ±</mi><msubsup><mi>y</mi><mn>1</mn><mrow><mi>œÅ</mi><mo>‚àí</mo><mn>1</mn></mrow></msubsup><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>‚àí</mo><msub><mi>t</mi><mn>1</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mi>‚àí</mi><mfrac><mn>1</mn><mrow><mi>œÅ</mi><mo>‚àí</mo><mn>1</mn></mrow></mfrac></mrow></msup><mspace width="2.0em"></mspace><mrow><mo stretchy="true" form="prefix">(</mo><mn>5</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
y(t) = y_1 \left(1 + (\rho-1)\alpha y_1^{\rho-1}(t-t_1)\right)^{-\frac{1}{\rho-1}}
 \qquad(5)</annotation></semantics></math></span>
</li>
</ul>
<p>The expression above corresponds to lines 18-50 of <code>model.jags</code>:</p>
<div class="sourceCode" id="cb3" data-startfrom="18"><pre class="sourceCode numberSource r number-lines"><code class="sourceCode r" style="counter-reset: source-line 17;"><span id="cb3-18"><a href="#cb3-18"></a>     mu.logy[subj, obs, cur_antigen_iso] <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(</span>
<span id="cb3-19"><a href="#cb3-19"></a>        </span>
<span id="cb3-20"><a href="#cb3-20"></a>        <span class="co"># `step(x)` returns 1 if x &gt;= 0;</span></span>
<span id="cb3-21"><a href="#cb3-21"></a>        <span class="co"># here we are determining which phase of infection we are in; </span></span>
<span id="cb3-22"><a href="#cb3-22"></a>        <span class="co"># active or recovery;</span></span>
<span id="cb3-23"><a href="#cb3-23"></a>        <span class="co"># `smpl.t` is the time when the blood sample was collected, </span></span>
<span id="cb3-24"><a href="#cb3-24"></a>        <span class="co"># relative to estimated start of infection;</span></span>
<span id="cb3-25"><a href="#cb3-25"></a>        <span class="co"># so we are determining whether the current observation is after `t1` </span></span>
<span id="cb3-26"><a href="#cb3-26"></a>        <span class="co"># the time when the active infection ended.</span></span>
<span id="cb3-27"><a href="#cb3-27"></a>        <span class="fu">step</span>(t1[subj,cur_antigen_iso] <span class="sc">-</span> smpl.t[subj,obs]), </span>
<span id="cb3-28"><a href="#cb3-28"></a>        </span>
<span id="cb3-29"><a href="#cb3-29"></a>        <span class="do">## active infection period:</span></span>
<span id="cb3-30"><a href="#cb3-30"></a>        <span class="co"># this is equation 15, case t &lt;= t_1, but on a logarithmic scale</span></span>
<span id="cb3-31"><a href="#cb3-31"></a>        <span class="fu">log</span>(y0[subj,cur_antigen_iso]) <span class="sc">+</span> (beta[subj,cur_antigen_iso] <span class="sc">*</span> smpl.t[subj,obs]),</span>
<span id="cb3-32"><a href="#cb3-32"></a>        </span>
<span id="cb3-33"><a href="#cb3-33"></a>        <span class="do">## recovery period:</span></span>
<span id="cb3-34"><a href="#cb3-34"></a>        <span class="co"># this is equation 15, case t &gt; t_1</span></span>
<span id="cb3-35"><a href="#cb3-35"></a>        <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> shape[subj,cur_antigen_iso]) <span class="sc">*</span></span>
<span id="cb3-36"><a href="#cb3-36"></a>           <span class="fu">log</span>(</span>
<span id="cb3-37"><a href="#cb3-37"></a>              <span class="co"># this is `log{y_1^(1-r)}`; </span></span>
<span id="cb3-38"><a href="#cb3-38"></a>              <span class="co"># the exponent cancels out with the factor outside the log</span></span>
<span id="cb3-39"><a href="#cb3-39"></a>              y1[subj, cur_antigen_iso]<span class="sc">^</span>(<span class="dv">1</span> <span class="sc">-</span> shape[subj, cur_antigen_iso]) <span class="sc">-</span> </span>
<span id="cb3-40"><a href="#cb3-40"></a>                 </span>
<span id="cb3-41"><a href="#cb3-41"></a>               <span class="co"># this is (1-r); not sure why switched from paper  </span></span>
<span id="cb3-42"><a href="#cb3-42"></a>              (<span class="dv">1</span> <span class="sc">-</span> shape[subj,cur_antigen_iso]) <span class="sc">*</span></span>
<span id="cb3-43"><a href="#cb3-43"></a>                </span>
<span id="cb3-44"><a href="#cb3-44"></a>                  <span class="co"># (there's no missing y1^(r-1) term here; the math checks out)</span></span>
<span id="cb3-45"><a href="#cb3-45"></a>                 </span>
<span id="cb3-46"><a href="#cb3-46"></a>                 <span class="co"># alpha is `nu` in Teunis 2016; the "decay rate" parameter</span></span>
<span id="cb3-47"><a href="#cb3-47"></a>                alpha[subj,cur_antigen_iso] <span class="sc">*</span></span>
<span id="cb3-48"><a href="#cb3-48"></a>                 </span>
<span id="cb3-49"><a href="#cb3-49"></a>                 <span class="co"># this is `t - t_1`</span></span>
<span id="cb3-50"><a href="#cb3-50"></a>                 (smpl.t[subj,obs] <span class="sc">-</span> t1[subj,cur_antigen_iso])))</span></code></pre></div>
<p><strong>Pathogen load:</strong></p>
<ul>
<li>For <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>‚â§</mo><msub><mi>t</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">t \leq t_1</annotation></semantics></math>: <span id="eq-6"><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>b</mi><mn>0</mn></msub><msup><mi>e</mi><mrow><msub><mi>Œº</mi><mi>b</mi></msub><mi>t</mi></mrow></msup><mo>‚àí</mo><mfrac><mrow><mi>Œ≥</mi><msub><mi>y</mi><mn>0</mn></msub></mrow><mrow><msub><mi>Œº</mi><mi>y</mi></msub><mo>‚àí</mo><msub><mi>Œº</mi><mi>b</mi></msub></mrow></mfrac><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>e</mi><mrow><msub><mi>Œº</mi><mi>y</mi></msub><mi>t</mi></mrow></msup><mo>‚àí</mo><msup><mi>e</mi><mrow><msub><mi>Œº</mi><mi>b</mi></msub><mi>t</mi></mrow></msup><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="2.0em"></mspace><mrow><mo stretchy="true" form="prefix">(</mo><mn>6</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
b(t) = b_0 e^{\mu_b t} - \frac{\gamma y_0}{\mu_y - \mu_b} \left( e^{\mu_y t} - e^{\mu_b t} \right)
 \qquad(6)</annotation></semantics></math></span>
</li>
<li>For <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mspace width="0.222em"></mspace><msub><mi>t</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">t \&gt; t_1</annotation></semantics></math>: <math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">
b(t) = 0
</annotation></semantics></math>
</li>
</ul>
<hr></section><section class="level2"><h2 id="step-4-derived-quantities">Step 4: Derived Quantities<a class="anchor" aria-label="anchor" href="#step-4-derived-quantities"></a>
</h2>
<ul>
<li>
<p><strong>Clearance Time</strong> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>t</mi><mn>1</mn></msub><annotation encoding="application/x-tex">t_1</annotation></semantics></math>:</p>
<p><span id="eq-7"><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>t</mi><mn>1</mn></msub><mo>=</mo><mfrac><mn>1</mn><mrow><msub><mi>Œº</mi><mi>y</mi></msub><mo>‚àí</mo><msub><mi>Œº</mi><mi>b</mi></msub></mrow></mfrac><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>+</mo><mfrac><mrow><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Œº</mi><mi>y</mi></msub><mo>‚àí</mo><msub><mi>Œº</mi><mi>b</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><msub><mi>b</mi><mn>0</mn></msub></mrow><mrow><mi>Œ≥</mi><msub><mi>y</mi><mn>0</mn></msub></mrow></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="2.0em"></mspace><mrow><mo stretchy="true" form="prefix">(</mo><mn>7</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
t_1 = \frac{1}{\mu_y - \mu_b} \log\left(1 + \frac{(\mu_y - \mu_b) b_0}{\gamma y_0}\right)
 \qquad(7)</annotation></semantics></math></span></p>
</li>
</ul>
<p>The expression above is indirectly represented by lines 8-12 of <code>model.jags</code>:</p>
<div class="sourceCode" id="cb4" data-startfrom="8"><pre class="sourceCode numberSource r number-lines"><code class="sourceCode r" style="counter-reset: source-line 7;"><span id="cb4-8"><a href="#cb4-8"></a>     beta[subj, cur_antigen_iso] <span class="ot">&lt;-</span> </span>
<span id="cb4-9"><a href="#cb4-9"></a>       <span class="fu">log</span>(</span>
<span id="cb4-10"><a href="#cb4-10"></a>         y1[subj,cur_antigen_iso] <span class="sc">/</span> y0[subj,cur_antigen_iso]</span>
<span id="cb4-11"><a href="#cb4-11"></a>         ) <span class="sc">/</span> </span>
<span id="cb4-12"><a href="#cb4-12"></a>       t1[subj,cur_antigen_iso]</span></code></pre></div>
<ul>
<li>
<p><strong>Peak Antibody Level</strong> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mn>1</mn></msub><annotation encoding="application/x-tex">y_1</annotation></semantics></math>:</p>
<p><span id="eq-8"><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mn>1</mn></msub><mo>=</mo><msub><mi>y</mi><mn>0</mn></msub><msup><mi>e</mi><mrow><msub><mi>Œº</mi><mi>y</mi></msub><msub><mi>t</mi><mn>1</mn></msub></mrow></msup><mspace width="2.0em"></mspace><mrow><mo stretchy="true" form="prefix">(</mo><mn>8</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
y_1 = y_0 e^{\mu_y t_1}
 \qquad(8)</annotation></semantics></math></span></p>
</li>
</ul>
<p>The expression above corresponds to line 59 of <code>model.jags</code>:</p>
<div class="sourceCode" id="cb5" data-startfrom="59"><pre class="sourceCode numberSource r number-lines"><code class="sourceCode r" style="counter-reset: source-line 58;"><span id="cb5-59"><a href="#cb5-59"></a>   y1[subj,cur_antigen_iso]    <span class="ot">&lt;-</span> y0[subj,cur_antigen_iso] <span class="sc">+</span> <span class="fu">exp</span>(par[subj,cur_antigen_iso,<span class="dv">2</span>]) <span class="co"># par[,,2] must be log(y1-y0)</span></span></code></pre></div>
<p><strong>Important</strong>: <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>t</mi><mn>1</mn></msub><annotation encoding="application/x-tex">t_1</annotation></semantics></math> and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mn>1</mn></msub><annotation encoding="application/x-tex">y_1</annotation></semantics></math> are <strong>derived</strong>, not fit parameters.</p>
<hr></section><section class="level2"><h2 id="full-parameter-model-7-parameters">Full Parameter Model (7 Parameters)<a class="anchor" aria-label="anchor" href="#full-parameter-model-7-parameters"></a>
</h2>
<p><strong>Subject-level parameters</strong> for each subject<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math> and biomarker <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>:</p>
<p><span id="eq-9"><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Œ∏</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>‚àº</mo><mi>ùí©</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Œº</mi><mi>j</mi></msub><mo>,</mo><mspace width="0.167em"></mspace><msub><mi>Œ£</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mspace width="1.0em"></mspace><msub><mi>Œ∏</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mrow><mo stretchy="true" form="prefix">[</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>y</mi><mrow><mn>0</mn><mo>,</mo><mi>i</mi><mi>j</mi></mrow></msub></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>b</mi><mrow><mn>0</mn><mo>,</mo><mi>i</mi><mi>j</mi></mrow></msub></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>Œº</mi><mrow><mi>b</mi><mo>,</mo><mi>i</mi><mi>j</mi></mrow></msub></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>Œº</mi><mrow><mi>y</mi><mo>,</mo><mi>i</mi><mi>j</mi></mrow></msub></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>Œ≥</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>Œ±</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>œÅ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mtd></mtr></mtable><mo stretchy="true" form="postfix">]</mo></mrow><mspace width="2.0em"></mspace><mrow><mo stretchy="true" form="prefix">(</mo><mn>9</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
\theta_{ij} \sim \mathcal{N}(\mu_j,\, \Sigma_j), \quad \theta_{ij} =
\begin{bmatrix}
y_{0,ij} \\
b_{0,ij} \\
\mu_{b,ij} \\
\mu_{y,ij} \\
\gamma_{ij} \\
\alpha_{ij} \\
\rho_{ij}
\end{bmatrix}
 \qquad(9)</annotation></semantics></math></span></p>
<ul>
<li>These 7 parameters represent the <strong>full biological model</strong> (antibody + pathogen dynamics)</li>
</ul>
<hr></section><section class="level2"><h2 id="from-full-7-parameters-to-5-latent-parameters">From Full 7 Parameters to 5 Latent Parameters<a class="anchor" aria-label="anchor" href="#from-full-7-parameters-to-5-latent-parameters"></a>
</h2>
<ul>
<li>Although the model estimates 7 parameters, for modeling antibody kinetics <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">y(t)</annotation></semantics></math>, we focus on <strong>5-parameter subset</strong>:</li>
</ul>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mn>0</mn></msub><mo>,</mo><mspace width="0.222em"></mspace><mspace width="0.222em"></mspace><msub><mi>t</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mtext mathvariant="normal">derived</mtext><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mspace width="0.222em"></mspace><mspace width="0.222em"></mspace><msub><mi>y</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mtext mathvariant="normal">derived</mtext><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mspace width="0.222em"></mspace><mspace width="0.222em"></mspace><mi>Œ±</mi><mo>,</mo><mspace width="0.222em"></mspace><mspace width="0.222em"></mspace><mi>œÅ</mi></mrow><annotation encoding="application/x-tex">y_0,\ \ t_1 (\text{derived}),\ \  y_1 (\text{derived}),\ \  \alpha,\ \  \rho</annotation></semantics></math></p>
<ul>
<li>These 5 parameters are <strong>log-transformed</strong> into the latent parameters <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Œ∏</mi><mi>_</mi><mrow><mi>i</mi><mi>j</mi></mrow></mrow><annotation encoding="application/x-tex">\theta\_{ij}</annotation></semantics></math> used for modeling.</li>
</ul>
<hr></section><section class="level2"><h2 id="core-parameters-used-for-curve-drawing">Core Parameters Used for Curve Drawing<a class="anchor" aria-label="anchor" href="#core-parameters-used-for-curve-drawing"></a>
</h2>
<p>Although the full model estimates <strong>7 parameters</strong>, only <strong>5 key parameters</strong> required to draw antibody curves:</p>
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mn>0</mn></msub><annotation encoding="application/x-tex">y_0</annotation></semantics></math>: initial antibody level</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>t</mi><mn>1</mn></msub><annotation encoding="application/x-tex">t_1</annotation></semantics></math>: time of peak antibody response (derived)</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mn>1</mn></msub><annotation encoding="application/x-tex">y_1</annotation></semantics></math>: peak antibody level (derived)</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œ±</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>: decay rate</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>œÅ</mi><annotation encoding="application/x-tex">\rho</annotation></semantics></math>: shape of decay</li>
</ul>
<p>Note: <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>t</mi><mn>1</mn></msub><annotation encoding="application/x-tex">t_1</annotation></semantics></math> and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mn>1</mn></msub><annotation encoding="application/x-tex">y_1</annotation></semantics></math> are <strong>derived from the full model</strong> - These 5 are sufficient for prediction and plotting</p>
<hr></section><section class="level2"><h2 id="step-5-subject-level-parameters-latent-version">Step 5: Subject-Level Parameters (Latent Version)<a class="anchor" aria-label="anchor" href="#step-5-subject-level-parameters-latent-version"></a>
</h2>
<p>Each subject <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math> and biomarker <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math> has latent parameters:</p>
<p><span id="eq-10"><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Œ∏</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mrow><mo stretchy="true" form="prefix">[</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mn>0</mn><mo>,</mo><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mn>1</mn><mo>,</mo><mi>i</mi><mi>j</mi></mrow></msub><mo>‚àí</mo><msub><mi>y</mi><mrow><mn>0</mn><mo>,</mo><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mrow><mn>1</mn><mo>,</mo><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Œ±</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>œÅ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>‚àí</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr></mtable><mo stretchy="true" form="postfix">]</mo></mrow><mspace width="2.0em"></mspace><mrow><mo stretchy="true" form="prefix">(</mo><mn>10</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
\theta_{ij} =
\begin{bmatrix}
\log(y_{0,ij}) \\
\log(y_{1,ij} - y_{0,ij}) \\
\log(t_{1,ij}) \\
\log(\alpha_{ij}) \\
\log(\rho_{ij} - 1)
\end{bmatrix}
 \qquad(10)</annotation></semantics></math></span></p>
<p>Distribution:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Œ∏</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>‚àº</mo><mi>ùí©</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Œº</mi><mi>j</mi></msub><mo>,</mo><msub><mi>Œ£</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
\theta_{ij} \sim \mathcal{N}(\mu_j, \Sigma_j)
</annotation></semantics></math></p>
<p>The expression above reflects the prior distribution specified on line 66 of <code>model.jags</code>:</p>
<div class="sourceCode" id="cb6" data-startfrom="66"><pre class="sourceCode numberSource r number-lines"><code class="sourceCode r" style="counter-reset: source-line 65;"><span id="cb6-66"><a href="#cb6-66"></a>   par[subj, cur_antigen_iso, <span class="dv">1</span><span class="sc">:</span>n_params] <span class="sc">~</span> <span class="fu">dmnorm</span>(mu.par[cur_antigen_iso,], prec.par[cur_antigen_iso,,])</span></code></pre></div>
<hr></section><section class="level2"><h2 id="step-6-parameter-transformations-log-scale-priors">Step 6: Parameter Transformations (log scale priors)<a class="anchor" aria-label="anchor" href="#step-6-parameter-transformations-log-scale-priors"></a>
</h2>
<p>JAGS implements latent parameters (par) as:</p>
<div id="tbl-transformation" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-tbl"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-transformation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table¬†2: Log-Scale Transformations of Antibody Model Parameters in JAGS.
</figcaption><div aria-describedby="tbl-transformation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table caption-top">
<thead><tr class="header">
<th style="text-align: left;">Model Parameter</th>
<th style="text-align: left;">Transformation in JAGS</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mn>0</mn></msub><annotation encoding="application/x-tex">y_0</annotation></semantics></math></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mtext mathvariant="normal">par</mtext><mn>1</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\exp(\text{par}_1)</annotation></semantics></math></td>
</tr>
<tr class="even">
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mn>1</mn></msub><annotation encoding="application/x-tex">y_1</annotation></semantics></math></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mn>0</mn></msub><mo>+</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mtext mathvariant="normal">par</mtext><mn>2</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">y_0 + \exp(\text{par}_2)</annotation></semantics></math></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>t</mi><mn>1</mn></msub><annotation encoding="application/x-tex">t_1</annotation></semantics></math></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mtext mathvariant="normal">par</mtext><mn>3</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\exp(\text{par}_3)</annotation></semantics></math></td>
</tr>
<tr class="even">
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œ±</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mtext mathvariant="normal">par</mtext><mn>4</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\exp(\text{par}_4)</annotation></semantics></math></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>œÅ</mi><annotation encoding="application/x-tex">\rho</annotation></semantics></math></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mtext mathvariant="normal">par</mtext><mn>5</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\exp(\text{par}_5) + 1</annotation></semantics></math></td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>The table above corresponds to lines 58-62 of <code>model.jags</code>:</p>
<div class="sourceCode" id="cb7" data-startfrom="58"><pre class="sourceCode numberSource r number-lines"><code class="sourceCode r" style="counter-reset: source-line 57;"><span id="cb7-58"><a href="#cb7-58"></a>   y0[subj,cur_antigen_iso]    <span class="ot">&lt;-</span> <span class="fu">exp</span>(par[subj,cur_antigen_iso,<span class="dv">1</span>])</span>
<span id="cb7-59"><a href="#cb7-59"></a>   y1[subj,cur_antigen_iso]    <span class="ot">&lt;-</span> y0[subj,cur_antigen_iso] <span class="sc">+</span> <span class="fu">exp</span>(par[subj,cur_antigen_iso,<span class="dv">2</span>]) <span class="co"># par[,,2] must be log(y1-y0)</span></span>
<span id="cb7-60"><a href="#cb7-60"></a>   t1[subj,cur_antigen_iso]    <span class="ot">&lt;-</span> <span class="fu">exp</span>(par[subj,cur_antigen_iso,<span class="dv">3</span>])</span>
<span id="cb7-61"><a href="#cb7-61"></a>   alpha[subj,cur_antigen_iso] <span class="ot">&lt;-</span> <span class="fu">exp</span>(par[subj,cur_antigen_iso,<span class="dv">4</span>]) <span class="co"># `nu` in the paper</span></span>
<span id="cb7-62"><a href="#cb7-62"></a>   shape[subj,cur_antigen_iso] <span class="ot">&lt;-</span> <span class="fu">exp</span>(par[subj,cur_antigen_iso,<span class="dv">5</span>]) <span class="sc">+</span> <span class="dv">1</span> <span class="co"># `r` in the paper</span></span></code></pre></div>
<p>All priors are thus applied on <strong>log scale</strong> (or log-minus-one for <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>œÅ</mi><annotation encoding="application/x-tex">\rho</annotation></semantics></math>).</p>
<hr></section><section class="level2"><h2 id="step-7-population-level-parameters-priors">Step 7: Population-Level Parameters (Priors)<a class="anchor" aria-label="anchor" href="#step-7-population-level-parameters-priors"></a>
</h2>
<p>The biomarker-specific mean vector <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œº</mi><mi>j</mi></msub><annotation encoding="application/x-tex">\mu_j</annotation></semantics></math> has a <strong>hyperprior</strong> :</p>
<p><span id="eq-11"><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Œº</mi><mi>j</mi></msub><mo>‚àº</mo><mi>ùí©</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Œº</mi><mrow><mtext mathvariant="normal">hyp</mtext><mo>,</mo><mi>j</mi></mrow></msub><mo>,</mo><msub><mi>Œ©</mi><mrow><mtext mathvariant="normal">hyp</mtext><mo>,</mo><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="2.0em"></mspace><mrow><mo stretchy="true" form="prefix">(</mo><mn>11</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
\mu_j \sim \mathcal{N}(\mu_{\text{hyp},j}, \Omega_{\text{hyp},j})
 \qquad(11)</annotation></semantics></math></span></p>
<p>Where:</p>
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œº</mi><mrow><mtext mathvariant="normal">hyp</mtext><mo>,</mo><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">\mu_{\text{hyp},j}</annotation></semantics></math> : <strong>prior mean</strong> for the population-level parameters<br>
</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œ©</mi><mrow><mtext mathvariant="normal">hyp</mtext><mo>,</mo><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">\Omega_{\text{hyp},j}</annotation></semantics></math> : <strong>prior covariance</strong> encoding uncertainty about <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œº</mi><mi>j</mi></msub><annotation encoding="application/x-tex">\mu_j</annotation></semantics></math> (e.g., <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>100</mn><mo>‚ãÖ</mo><msub><mi>I</mi><mn>7</mn></msub></mrow><annotation encoding="application/x-tex">100 \cdot I_7</annotation></semantics></math> for weakly informative prior)</li>
</ul>
<p>The expression above corresponds to line 73 of <code>model.jags</code>:</p>
<div class="sourceCode" id="cb8" data-startfrom="73"><pre class="sourceCode numberSource r number-lines"><code class="sourceCode r" style="counter-reset: source-line 72;"><span id="cb8-73"><a href="#cb8-73"></a>  mu.par[cur_antigen_iso, <span class="dv">1</span><span class="sc">:</span>n_params] <span class="sc">~</span> <span class="fu">dmnorm</span>(mu.hyp[cur_antigen_iso,], prec.hyp[cur_antigen_iso,,])</span></code></pre></div>
<p><strong>Clarification:</strong></p>
<ul>
<li><p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œº</mi><mrow><mtext mathvariant="normal">hyp</mtext><mo>,</mo><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">\mu_{\text{hyp},j}</annotation></semantics></math> defines the <strong>center of a distribution, not</strong> a single point guess.</p></li>
<li><p>In Bayesian modeling, <strong>priors and hyperpriors are distributions</strong> over unknown quantities, capturing full uncertainty.</p></li>
</ul>
<hr></section><section class="level2"><h2 id="step-8-prior-on-covariance-matrices">Step 8: Prior on Covariance Matrices<a class="anchor" aria-label="anchor" href="#step-8-prior-on-covariance-matrices"></a>
</h2>
<p>We also don‚Äôt know how much individual parameters vary. So we assign a <strong>Wishart prior</strong> to the <strong>inverse</strong> covariance matrix:</p>
<p><span id="eq-12"><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>Œ£</mi><mi>j</mi><mrow><mi>‚àí</mi><mn>1</mn></mrow></msubsup><mo>‚àº</mo><mi>ùí≤</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Œ©</mi><mi>j</mi></msub><mo>,</mo><msub><mi>ŒΩ</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="2.0em"></mspace><mrow><mo stretchy="true" form="prefix">(</mo><mn>12</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
\Sigma_j^{-1} \sim \mathcal{W}(\Omega_j, \nu_j)
 \qquad(12)</annotation></semantics></math></span></p>
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œ©</mi><mi>j</mi></msub><annotation encoding="application/x-tex">\Omega_j</annotation></semantics></math> : prior scale matrix (small variance across parameters, often <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0.1</mn><mo>‚ãÖ</mo><msub><mi>I</mi><mn>7</mn></msub></mrow><annotation encoding="application/x-tex">0.1 \cdot I_7</annotation></semantics></math>)</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ŒΩ</mi><mi>j</mi></msub><annotation encoding="application/x-tex">\nu_j</annotation></semantics></math> : degrees of freedom</li>
</ul>
<p>The expression above corresponds to line 74 of <code>model.jags</code>:</p>
<div class="sourceCode" id="cb9" data-startfrom="74"><pre class="sourceCode numberSource r number-lines"><code class="sourceCode r" style="counter-reset: source-line 73;"><span id="cb9-74"><a href="#cb9-74"></a>  prec.par[cur_antigen_iso, <span class="dv">1</span><span class="sc">:</span>n_params, <span class="dv">1</span><span class="sc">:</span>n_params] <span class="sc">~</span> <span class="fu">dwish</span>(omega[cur_antigen_iso,,], wishdf[cur_antigen_iso])</span></code></pre></div>
<p>Higher <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ŒΩ</mi><mi>j</mi></msub><annotation encoding="application/x-tex">\nu_j</annotation></semantics></math><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>‚Üí</mo><annotation encoding="application/x-tex">\rightarrow</annotation></semantics></math> more informative prior (stronger prior).</p>
<p>Lower <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ŒΩ</mi><mi>j</mi></msub><annotation encoding="application/x-tex">\nu_j</annotation></semantics></math><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>‚Üí</mo><annotation encoding="application/x-tex">\rightarrow</annotation></semantics></math> more weakly informative (broader prior or weaker prior).</p>
<p>This tells the model how much we expect individuals to vary from the average for biomarker <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>.</p>
<hr></section><section class="level2"><h2 id="putting-it-all-together">Putting It All Together<a class="anchor" aria-label="anchor" href="#putting-it-all-together"></a>
</h2>
<p>The model is built hierarchically across five conceptual levels:</p>
<ol type="1">
<li>
<strong>Observed data:</strong> noisy log antibody concentrations from serum samples</li>
<li>
<strong>Latent individual parameters:</strong> hidden antibody dynamics <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œ∏</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">\theta_{ij}</annotation></semantics></math> for each subject-biomarker pair</li>
<li>
<strong>Population-level means:</strong> average antibody parameters for each biomarker</li>
<li>
<strong>Hyperpriors on means:</strong> our belief about the likely range of biomarker-specific population means</li>
<li>
<strong>Priors on variability:</strong> our belief about how much individual parameters vary around the population mean</li>
</ol>
<p>This structure allows us to account for uncertainty at every level, while borrowing strength across subjects and biomarkers.</p>
<hr></section><section class="level2"><h2 id="summary-of-the-hierarchy">Summary of the Hierarchy<a class="anchor" aria-label="anchor" href="#summary-of-the-hierarchy"></a>
</h2>
<ol type="1">
<li>
<p><strong>Top Level</strong>:</p>
<ul>
<li>For each biomarker <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>, the true mean antibody trajectory parameters <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œº</mi><mi>j</mi></msub><annotation encoding="application/x-tex">\mu_j</annotation></semantics></math> come from a prior:
<ul>
<li><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Œº</mi><mi>j</mi></msub><mo>‚àº</mo><mi>ùí©</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Œº</mi><mrow><mtext mathvariant="normal">hyp</mtext><mo>,</mo><mi>j</mi></mrow></msub><mo>,</mo><msub><mi>Œ©</mi><mrow><mtext mathvariant="normal">hyp</mtext><mo>,</mo><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mu_j \sim \mathcal{N}(\mu_{\text{hyp},j}, \Omega_{\text{hyp},j})</annotation></semantics></math></li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Middle Level</strong>:</p>
<ul>
<li>For each person <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>, their parameters:
<ul>
<li><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Œ∏</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>‚àº</mo><mi>ùí©</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Œº</mi><mi>j</mi></msub><mo>,</mo><msub><mi>Œ£</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\theta_{ij} \sim \mathcal{N}(\mu_j, \Sigma_j)</annotation></semantics></math></li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Bottom Level</strong>:</p>
<ul>
<li>Their actual observed antibody levels are noisy measurements of predictions from <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œ∏</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">\theta_{ij}</annotation></semantics></math>:
<ul>
<li><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mtext mathvariant="normal">obs</mtext><mo>,</mo><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚àº</mo><mi>ùí©</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Œº</mi><mrow><mo>log</mo><mi>y</mi><mo>,</mo><mi>i</mi><mi>j</mi></mrow></msub><mo>,</mo><msubsup><mi>œÑ</mi><mi>j</mi><mrow><mi>‚àí</mi><mn>1</mn></mrow></msubsup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\log(y_{\text{obs},ij}) \sim \mathcal{N}(\mu_{\log y,ij}, \tau_j^{-1})</annotation></semantics></math></li>
</ul>
</li>
</ul>
</li>
</ol>
<p>Where:</p>
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œº</mi><mrow><mo>log</mo><mi>y</mi><mo>,</mo><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">\mu_{\log y,ij}</annotation></semantics></math> is the <strong>expected log antibody level</strong>, computed from the two-phase model using subject-level parameters <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œ∏</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">\theta_{ij}</annotation></semantics></math>.</li>
<li>Predictions use <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œ∏</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">\theta_{ij}</annotation></semantics></math> to compute <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œº</mi><mrow><mo>log</mo><mi>y</mi><mo>,</mo><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">\mu_{\log y,ij}</annotation></semantics></math>, which is then compared to the observed log antibody data.</li>
</ul>
<hr></section><section class="level2"><h2 id="clarification-how-bottom-level-depends-on-middle-level">Clarification: How Bottom Level Depends on Middle Level<a class="anchor" aria-label="anchor" href="#clarification-how-bottom-level-depends-on-middle-level"></a>
</h2>
<p>We know the following facts:</p>
<ol type="1">
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œ∏</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">\theta_{ij}</annotation></semantics></math> are the <strong>subject-level latent parameters</strong> (like <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mn>0</mn></msub><mo>,</mo><msub><mi>b</mi><mn>0</mn></msub><mo>,</mo><mi>Œº</mi><mi>_</mi><mi>b</mi><mo>,</mo><mi>Œº</mi><mi>_</mi><mi>y</mi><mo>,</mo><mi>Œ≥</mi><mo>,</mo><mi>Œ±</mi><mo>,</mo><mi>œÅ</mi></mrow><annotation encoding="application/x-tex">y_0, b_0, \mu\_b, \mu\_y, \gamma, \alpha, \rho</annotation></semantics></math>).</li>
<li>From <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œ∏</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">\theta_{ij}</annotation></semantics></math>, we calculate the expected <strong>log antibody level</strong> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œº</mi><mrow><mo>log</mo><mi>y</mi><mo>,</mo><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">\mu_{\log y,ij}</annotation></semantics></math> using the ODE-based two-phase model.</li>
<li>The <strong>observed log-antibody</strong> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mtext mathvariant="normal">obs</mtext><mo>,</mo><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\log(y_{\text{obs},ij})</annotation></semantics></math> is modeled as a <strong>noisy version</strong> of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œº</mi><mrow><mo>log</mo><mi>y</mi><mo>,</mo><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">\mu_{\log y,ij}</annotation></semantics></math>.</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>œÑ</mi><mi>j</mi></msub><annotation encoding="application/x-tex">\tau_j</annotation></semantics></math> is the precision (measurement noise precision for biomarker <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>).</li>
</ol>
<p>Thus, at the <strong>Bottom Level</strong>, we model:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mtext mathvariant="normal">obs</mtext><mo>,</mo><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚àº</mo><mi>ùí©</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Œº</mi><mrow><mo>log</mo><mi>y</mi><mo>,</mo><mi>i</mi><mi>j</mi></mrow></msub><mo>,</mo><msubsup><mi>œÑ</mi><mi>j</mi><mrow><mi>‚àí</mi><mn>1</mn></mrow></msubsup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
\log(y_{\text{obs},ij}) \sim \mathcal{N}(\mu_{\log y,ij}, \tau_j^{-1})
</annotation></semantics></math></p>
<p>Here:</p>
<ul>
<li>The <strong>mean</strong> is <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œº</mi><mrow><mo>log</mo><mi>y</mi><mo>,</mo><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">\mu_{\log y,ij}</annotation></semantics></math> ‚Äî derived from the <strong>ODE solution</strong> using <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œ∏</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">\theta_{ij}</annotation></semantics></math>.</li>
<li>The <strong>variance</strong> is <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>œÑ</mi><mi>j</mi><mrow><mi>‚àí</mi><mn>1</mn></mrow></msubsup><annotation encoding="application/x-tex">\tau_j^{-1}</annotation></semantics></math> ‚Äî shared across individuals for a given biomarker.</li>
</ul>
<p>Summary:</p>
<ul>
<li>Observations depend indirectly on latent parameters <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œ∏</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">\theta_{ij}</annotation></semantics></math> via the predicted log antibody levels <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œº</mi><mrow><mo>log</mo><mi>y</mi><mo>,</mo><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">\mu_{\log y,ij}</annotation></semantics></math>.</li>
</ul>
<hr></section><section class="level2"><h2 id="summary-mapping-of-notation">Summary Mapping of Notation<a class="anchor" aria-label="anchor" href="#summary-mapping-of-notation"></a>
</h2>
<table class="table caption-top">
<colgroup>
<col style="width: 25%">
<col style="width: 44%">
<col style="width: 30%">
</colgroup>
<thead><tr class="header">
<th>Symbol</th>
<th>Meaning</th>
<th>JAGS Variable</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math></td>
<td>Subject index</td>
<td><code>subj</code></td>
</tr>
<tr class="even">
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math></td>
<td>Antigen-isotype (biomarker) index</td>
<td><code>cur_antigen_iso</code></td>
</tr>
<tr class="odd">
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mrow><mtext mathvariant="normal">obs</mtext><mo>,</mo><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">y_{\text{obs},ij}</annotation></semantics></math></td>
<td>Observed antibody concentration at a timepoint</td>
<td><code>logy[subj, obs, cur_antigen_iso]</code></td>
</tr>
<tr class="even">
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œº</mi><mrow><mo>log</mo><mi>y</mi><mo>,</mo><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">\mu_{\log y,ij}</annotation></semantics></math></td>
<td>Expected log antibody level based on ODE model using <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œ∏</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">\theta_{ij}</annotation></semantics></math>
</td>
<td><code>mu.logy[subj, obs, cur_antigen_iso]</code></td>
</tr>
<tr class="odd">
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œ∏</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">\theta_{ij}</annotation></semantics></math></td>
<td>Subject-level latent parameters for modeling <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">y(t)</annotation></semantics></math>
</td>
<td><code>par[subj, cur_antigen_iso, 1:n_params]</code></td>
</tr>
<tr class="even">
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œº</mi><mi>j</mi></msub><annotation encoding="application/x-tex">\mu_j</annotation></semantics></math></td>
<td>Mean vector of latent parameters across subjects for biomarker <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>
</td>
<td><code>mu.par[cur_antigen_iso, ]</code></td>
</tr>
<tr class="odd">
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œ£</mi><mi>j</mi></msub><annotation encoding="application/x-tex">\Sigma_j</annotation></semantics></math></td>
<td>Covariance matrix of latent parameters for biomarker <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>
</td>
<td><code>inverse of prec.par[cur_antigen_iso, , ]</code></td>
</tr>
<tr class="even">
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>œÑ</mi><mi>j</mi></msub><annotation encoding="application/x-tex">\tau_j</annotation></semantics></math></td>
<td>Precision (inverse variance) of measurement error for biomarker <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>
</td>
<td><code>prec.logy[cur_antigen_iso]</code></td>
</tr>
<tr class="odd">
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>a</mi><mi>j</mi></msub><mo>,</mo><msub><mi>b</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(a_j, b_j)</annotation></semantics></math></td>
<td>Gamma prior hyperparameters for <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>œÑ</mi><mi>j</mi></msub><annotation encoding="application/x-tex">\tau_j</annotation></semantics></math>
</td>
<td><code>prec.logy.hyp[cur_antigen_iso, 1/2]</code></td>
</tr>
<tr class="even">
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œº</mi><mrow><mtext mathvariant="normal">hyp</mtext><mo>,</mo><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">\mu_{\text{hyp},j}</annotation></semantics></math></td>
<td>Prior mean for <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œº</mi><mi>j</mi></msub><annotation encoding="application/x-tex">\mu_j</annotation></semantics></math>
</td>
<td><code>mu.hyp[cur_antigen_iso, ]</code></td>
</tr>
<tr class="odd">
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œ©</mi><mrow><mtext mathvariant="normal">hyp</mtext><mo>,</mo><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">\Omega_{\text{hyp},j}</annotation></semantics></math></td>
<td>Prior precision for <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œº</mi><mi>j</mi></msub><annotation encoding="application/x-tex">\mu_j</annotation></semantics></math>
</td>
<td><code>prec.hyp[cur_antigen_iso, , ]</code></td>
</tr>
<tr class="even">
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Œ©</mi><mi>j</mi></msub><mo>,</mo><msub><mi>ŒΩ</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(\Omega_j, \nu_j)</annotation></semantics></math></td>
<td>Wishart scale and degrees of freedom for <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>Œ£</mi><mi>j</mi><mrow><mi>‚àí</mi><mn>1</mn></mrow></msubsup><annotation encoding="application/x-tex">\Sigma_j^{-1}</annotation></semantics></math>
</td>
<td><code>omega[cur_antigen_iso, , ], wishdf[...]</code></td>
</tr>
</tbody>
</table>
<hr></section><section class="level2"><h2 id="model-comparison-teunis2016-vs--our-presentation">Model Comparison <span class="citation" data-cites="teunis2016">(<a href="#ref-teunis2016" role="doc-biblioref">Teunis and Eijkeren 2016</a>)</span> vs.¬†Our Presentation<a class="anchor" aria-label="anchor" href="#model-comparison-teunis2016-vs--our-presentation"></a>
</h2>
<div id="tbl-model-comparison" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-tbl"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-model-comparison-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table¬†3: Comparison of Teunis (2016) model and this presentation‚Äôs model assumptions.
</figcaption><div aria-describedby="tbl-model-comparison-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table caption-top">
<colgroup>
<col style="width: 29%">
<col style="width: 31%">
<col style="width: 38%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Component</th>
<th style="text-align: left;"><span class="citation" data-cites="teunis2016">(<a href="#ref-teunis2016" role="doc-biblioref">Teunis and Eijkeren 2016</a>)</span></th>
<th style="text-align: left;">This Presentation</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Pathogen ODE</td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Œº</mi><mn>0</mn></msub><mi>b</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚àí</mo><mi>c</mi><mi>y</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mu_0 b(t) - c y(t)</annotation></semantics></math></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Œº</mi><mi>b</mi></msub><mi>b</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚àí</mo><mi>Œ≥</mi><mi>y</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mu_b b(t) - \gamma y(t)</annotation></semantics></math></td>
</tr>
<tr class="even">
<td style="text-align: left;">Antibody growth ODE</td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Œº</mi><mi>y</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mu y(t)</annotation></semantics></math></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Œº</mi><mi>y</mi></msub><mi>y</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mu_y y(t)</annotation></semantics></math></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Antibody decay ODE</td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>‚àí</mi><mi>Œ±</mi><mi>y</mi><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>r</mi></msup></mrow><annotation encoding="application/x-tex">-\alpha y(t)^r</annotation></semantics></math></td>
<td style="text-align: left;"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>‚àí</mi><mi>Œ±</mi><mi>y</mi><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>œÅ</mi></msup></mrow><annotation encoding="application/x-tex">-\alpha y(t)^\rho</annotation></semantics></math></td>
</tr>
<tr class="even">
<td style="text-align: left;">Growth mechanism</td>
<td style="text-align: left;">Pathogen-driven</td>
<td style="text-align: left;">Self-driven</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-teunis2016" class="csl-entry" role="listitem">
Teunis, Peter F. M., and J. C. H. van Eijkeren. 2016. <span>‚ÄúLinking the Seroresponse to Infection to Within-Host Heterogeneity in Antibody Production.‚Äù</span> <em>Epidemics</em> 16: 33‚Äì39. <a href="https://doi.org/10.1016/j.epidem.2016.04.001" class="external-link">https://doi.org/10.1016/j.epidem.2016.04.001</a>.
</div>
</div>
</section><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config);
    }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script></main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Peter Teunis, Samuel Schildhauer, Kristen Aiemjoy, Douglas Ezra Morrison.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.9000.</p>
</div>

    </footer>
</div>





  </body>
</html>
